#!/usr/bin/env bash
# doc: Přidává aktuální adresář do bookmarks a spravuje seznam záložek

# Define the bookmark file
BOOKMARK_FILE="$HOME/dotfiles/bookmarks"
BACKUP="$BOOKMARK_FILE.old"
UNIQUE="$BOOKMARK_FILE.unique"

# Create the bookmark file if it doesn't exist
if [ ! -f "$BOOKMARK_FILE" ]; then
    touch "$BOOKMARK_FILE"
fi

# Get the current working directory
CURRENT_DIR="$(pwd)"


# Check if any parameters were supplied
if [ "$#" -eq 0 ]; then
    echo "No parameters supplied."
else
    echo "Parameters supplied: $@"
    echo "Using $1 as mark"
    CURRENT_DIR=$1
fi

# Check if the current directory is already in the bookmark file
if [[ $CURRENT_DIR == "edit" ]]; then
    vim $BOOKMARK_FILE
else
    if ! grep -Fxq "$CURRENT_DIR" "$BOOKMARK_FILE"; then
        # If not present, add it to the bookmark file
        echo "$CURRENT_DIR" >> "$BOOKMARK_FILE"
        mv $BOOKMARK_FILE $BACKUP
        sort $BACKUP > $BOOKMARK_FILE
        rm $BACKUP
        echo "Added $CURRENT_DIR to bookmarks."
    else
        echo "$CURRENT_DIR is already bookmarked."
    fi
fi

# deduplicate
[[ -f "$UNIQUE" ]] && rm "$UNIQUE"
cat "$BOOKMARK_FILE" | uniq >"$UNIQUE"
rm "$BOOKMARK_FILE"
cp "$UNIQUE" "$BOOKMARK_FILE"
rm "$UNIQUE"