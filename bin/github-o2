#!/bin/bash

# colors
ERR="\e[31mERR\e[0m"
TRY="\033[33mTRY\033[0m"
OK="\033[34mOK\033[0m "

# path
PAT_FILE=$HOME/Vaults/o2/github/jan_herout_pat

# kontrola existence secrets souboru a mount vaultu
echo -e "$TRY: test secrets file: $PAT_FILE"
if [ ! -f "$PAT_FILE" ]; then
    echo -e "$ERR: File does not exist: $PAT_FILE"
    cryfs $HOME/.local/share/plasma-vault/o2.enc $HOME/Vaults/o2/
fi

# pokud ani potom neexistuje, bail
if [ ! -f "$PAT_FILE" ]; then
    echo -e "$ERR: File does not exist: $PAT_FILE"
    exit 1
fi

GITHUB_TOKEN=$(cat $PAT_FILE)
if [ -z "$PAT_FILE" ]; then
    echo -e "$ERR: read secrets: failed: $PAT_FILE"
    exit 1
fi
echo -e "$OK: secrets read"

export GITHUB_TOKEN