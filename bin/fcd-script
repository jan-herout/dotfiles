#!/usr/bin/env bash
# doc: Přepínání mezi adresáři a URL z bookmarks pomocí fzf

[ "$(type -t include)" != 'function' ]&&{ include(){ { [ -z "$_IR" ]&&_IR="$PWD"&&cd "$(dirname "${BASH_SOURCE[0]}")"&&include "$1"&&cd "$_IR"&&unset _IR;}||{ local d="$PWD"&&cd "$(dirname "$PWD/$1")"&&. "$(basename "$1")"&&cd "$d";}||{ echo "Include failed $PWD->$1"&&exit 1;};};}
include "lib/user_io.sh"
include "lib/die.sh"

BOOKMARKS_FILE=~/bookmarks
SELECTED_DIR=$(cat "$BOOKMARKS_FILE" | fzf)
BROWSER=/usr/bin/google-chrome-stable

if [[ ! -n "$SELECTED_DIR" ]]; then 
    printError "No directory selected."
else
    # check if it starts with a slash
    if [[ $SELECTED_DIR == /* ]]; then        
        SELECTED_DIR="${SELECTED_DIR%%#*}" # get everything before the pound (strip comments)
        SELECTED_DIR=$(echo "$SELECTED_DIR" | sed 's/[[:space:]]*$//') # strip spaces at the end        
        cd "$SELECTED_DIR"
        printSuccess "cd $SELECTED_DIR"
    fi

    # check if it starts with a slash
    if [[ $SELECTED_DIR == http* ]]; then    
        $BROWSER "$SELECTED_DIR"

    fi
fi