#!/bin/bash

#!/bin/bash

# Set the timeout for pinging the server
timeout_seconds=1

# Loop through all mounted CIFS shares
while read -r line; do
    smb_server=$(echo $line | grep -oP '^//.*?/') 
    smb_server=${smb_server:2:-1}
    smb_share=$(echo $line | grep -oP '^//.*? on ') 
    smb_share=${smb_share:0:-4}

    # Ping the SMB server to check if it's reachable
    if ! ping -c 1 -W $timeout_seconds $smb_server > /dev/null; then
        echo "Unmounting offline share: $smb_share"
        umount -l "$smb_share"  # Lazy unmount
    fi
done < <(mount -t cifs)
