#!/bin/bash

SELECTION="__"
CONTINUE="__"
FILE_LIST=""
GITDIR="$HOME/o2/bimain/meta"

# sestavíme seznam souborů do proměnné, oddělovačem je středník
while [[ -n "$CONTINUE" ]]
do
    SELECTION=$(find $GITDIR| fzf)

    if [[ -n "$SELECTION" ]]; then
        if [[ -n "$FILE_LIST" ]]; then
            FILE_LIST+=";$SELECTION"
        else
            FILE_LIST+="$SELECTION"
        fi
    else
        CONTINUE=""
    fi
done


# iterujeme přes jednotlivé soubory
IFS=";" read -ra FILES <<< "$FILE_LIST"
for FILE in "${FILES[@]}"; do 
    FILE=$(realpath "$FILE")    
    FILE_NAME=$(basename "$FILE")
    
    PARENT=$(dirname "$FILE") # get the parent
    REL_PATH="${FILE#$GITDIR}"  # cesta uvnitř git_dir
    REL_PARENT="${PARENT#$GITDIR}" # cesta uvnitř gitdir, ale k parent složce

    DEST="$PWD/metadata/$REL_PARENT"
    DEST=$(echo $DEST | sed s/ddl/tables/)
    TF="$DEST/$FILE_NAME"
    mkdir -p "$DEST"
    cp $FILE $TF
done
